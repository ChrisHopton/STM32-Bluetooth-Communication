{"ast":null,"code":"import React,{useState,useEffect}from'react';import{jsx as _jsx}from\"react/jsx-runtime\";const ChatApp=()=>{const[response,setResponse]=useState(null);useEffect(()=>{const getToken=async()=>{try{const resp=await fetch(\"https://chat.openai.com/api/auth/session\");if(resp.status===403){throw new Error('CLOUDFLARE');}const data=await resp.json();if(!data.accessToken){throw new Error('ERROR No token');}return data.accessToken;}catch(err){throw new Error('ERROR idk');}};const getResponse=async question=>{try{const accessToken=await getToken();const res=await fetch(\"https://chat.openai.com/backend-api/conversation\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\",\"Authorization\":\"Bearer \"+accessToken},body:JSON.stringify({action:\"next\",messages:[{id:uid(),role:\"user\",content:{content_type:\"text\",parts:[question]}}],model:\"text-davinci-002-render\",parent_message_id:uid()})});const reader=res.body.getReader();let responseData='';while(true){const{done,value}=await reader.read();if(done)break;if(done===undefined||value===undefined){throw new Error('ERROR');}responseData+=new TextDecoder().decode(value);}setResponse(responseData);}catch(e){setResponse(e.message);}};// Example usage:\nconst question=\"Your question goes here\";getResponse(question);},[]);return/*#__PURE__*/_jsx(\"div\",{children:response===null?'Loading...':response});};export default ChatApp;","map":{"version":3,"names":["React","useState","useEffect","jsx","_jsx","ChatApp","response","setResponse","getToken","resp","fetch","status","Error","data","json","accessToken","err","getResponse","question","res","method","headers","body","JSON","stringify","action","messages","id","uid","role","content","content_type","parts","model","parent_message_id","reader","getReader","responseData","done","value","read","undefined","TextDecoder","decode","e","message","children"],"sources":["C:/Users/mathe/Dropbox/PC/Documents/GitHub/STM32-Bluetooth-Communication/my-app/src/components/OpenAIAPI.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\n\r\nconst ChatApp: React.FC = () => {\r\n  const [response, setResponse] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    const getToken = async () => {\r\n      try {\r\n        const resp = await fetch(\"https://chat.openai.com/api/auth/session\");\r\n        if (resp.status === 403) {\r\n          throw new Error('CLOUDFLARE');\r\n        }\r\n        const data = await resp.json();\r\n        if (!data.accessToken) {\r\n          throw new Error('ERROR No token');\r\n        }\r\n        return data.accessToken;\r\n      } catch (err) {\r\n        throw new Error('ERROR idk');\r\n      }\r\n    };\r\n\r\n    const getResponse = async (question: string) => {\r\n      try {\r\n        const accessToken = await getToken();\r\n        const res = await fetch(\"https://chat.openai.com/backend-api/conversation\", {\r\n          method: \"POST\",\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            \"Authorization\": \"Bearer \" + accessToken,\r\n          },\r\n          body: JSON.stringify({\r\n            action: \"next\",\r\n            messages: [\r\n              {\r\n                id: uid(),\r\n                role: \"user\",\r\n                content: {\r\n                  content_type: \"text\",\r\n                  parts: [question]\r\n                }\r\n              }\r\n            ],\r\n            model: \"text-davinci-002-render\",\r\n            parent_message_id: uid()\r\n          })\r\n        });\r\n        const reader = res.body.getReader();\r\n        let responseData = '';\r\n\r\n        while (true) {\r\n          const { done, value } = await reader.read();\r\n          if (done) break;\r\n          if (done === undefined || value === undefined) {\r\n            throw new Error('ERROR');\r\n          }\r\n          responseData += new TextDecoder().decode(value);\r\n        }\r\n\r\n        setResponse(responseData);\r\n      } catch (e) {\r\n        setResponse(e.message);\r\n      }\r\n    };\r\n\r\n    // Example usage:\r\n    const question = \"Your question goes here\";\r\n    getResponse(question);\r\n  }, []);\r\n\r\n  return (\r\n    <div>\r\n      {/* Render the response or loading/error messages */}\r\n      {response === null ? 'Loading...' : response}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ChatApp;\r\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAAC,OAAAC,GAAA,IAAAC,IAAA,yBAEnD,KAAM,CAAAC,OAAiB,CAAGA,CAAA,GAAM,CAC9B,KAAM,CAACC,QAAQ,CAAEC,WAAW,CAAC,CAAGN,QAAQ,CAAgB,IAAI,CAAC,CAE7DC,SAAS,CAAC,IAAM,CACd,KAAM,CAAAM,QAAQ,CAAG,KAAAA,CAAA,GAAY,CAC3B,GAAI,CACF,KAAM,CAAAC,IAAI,CAAG,KAAM,CAAAC,KAAK,CAAC,0CAA0C,CAAC,CACpE,GAAID,IAAI,CAACE,MAAM,GAAK,GAAG,CAAE,CACvB,KAAM,IAAI,CAAAC,KAAK,CAAC,YAAY,CAAC,CAC/B,CACA,KAAM,CAAAC,IAAI,CAAG,KAAM,CAAAJ,IAAI,CAACK,IAAI,CAAC,CAAC,CAC9B,GAAI,CAACD,IAAI,CAACE,WAAW,CAAE,CACrB,KAAM,IAAI,CAAAH,KAAK,CAAC,gBAAgB,CAAC,CACnC,CACA,MAAO,CAAAC,IAAI,CAACE,WAAW,CACzB,CAAE,MAAOC,GAAG,CAAE,CACZ,KAAM,IAAI,CAAAJ,KAAK,CAAC,WAAW,CAAC,CAC9B,CACF,CAAC,CAED,KAAM,CAAAK,WAAW,CAAG,KAAO,CAAAC,QAAgB,EAAK,CAC9C,GAAI,CACF,KAAM,CAAAH,WAAW,CAAG,KAAM,CAAAP,QAAQ,CAAC,CAAC,CACpC,KAAM,CAAAW,GAAG,CAAG,KAAM,CAAAT,KAAK,CAAC,kDAAkD,CAAE,CAC1EU,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,CACP,cAAc,CAAE,kBAAkB,CAClC,eAAe,CAAE,SAAS,CAAGN,WAC/B,CAAC,CACDO,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CACnBC,MAAM,CAAE,MAAM,CACdC,QAAQ,CAAE,CACR,CACEC,EAAE,CAAEC,GAAG,CAAC,CAAC,CACTC,IAAI,CAAE,MAAM,CACZC,OAAO,CAAE,CACPC,YAAY,CAAE,MAAM,CACpBC,KAAK,CAAE,CAACd,QAAQ,CAClB,CACF,CAAC,CACF,CACDe,KAAK,CAAE,yBAAyB,CAChCC,iBAAiB,CAAEN,GAAG,CAAC,CACzB,CAAC,CACH,CAAC,CAAC,CACF,KAAM,CAAAO,MAAM,CAAGhB,GAAG,CAACG,IAAI,CAACc,SAAS,CAAC,CAAC,CACnC,GAAI,CAAAC,YAAY,CAAG,EAAE,CAErB,MAAO,IAAI,CAAE,CACX,KAAM,CAAEC,IAAI,CAAEC,KAAM,CAAC,CAAG,KAAM,CAAAJ,MAAM,CAACK,IAAI,CAAC,CAAC,CAC3C,GAAIF,IAAI,CAAE,MACV,GAAIA,IAAI,GAAKG,SAAS,EAAIF,KAAK,GAAKE,SAAS,CAAE,CAC7C,KAAM,IAAI,CAAA7B,KAAK,CAAC,OAAO,CAAC,CAC1B,CACAyB,YAAY,EAAI,GAAI,CAAAK,WAAW,CAAC,CAAC,CAACC,MAAM,CAACJ,KAAK,CAAC,CACjD,CAEAhC,WAAW,CAAC8B,YAAY,CAAC,CAC3B,CAAE,MAAOO,CAAC,CAAE,CACVrC,WAAW,CAACqC,CAAC,CAACC,OAAO,CAAC,CACxB,CACF,CAAC,CAED;AACA,KAAM,CAAA3B,QAAQ,CAAG,yBAAyB,CAC1CD,WAAW,CAACC,QAAQ,CAAC,CACvB,CAAC,CAAE,EAAE,CAAC,CAEN,mBACEd,IAAA,QAAA0C,QAAA,CAEGxC,QAAQ,GAAK,IAAI,CAAG,YAAY,CAAGA,QAAQ,CACzC,CAAC,CAEV,CAAC,CAED,cAAe,CAAAD,OAAO"},"metadata":{},"sourceType":"module","externalDependencies":[]}